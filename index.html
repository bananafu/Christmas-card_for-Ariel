<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Christmas Card</title>
  <style>
    html, body { margin: 0; padding: 0; background: #050814; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <!-- p5 + p5.sound -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/addons/p5.sound.min.js"></script>

  <script>
    // ====== Customize here ======
    const TO_NAME   = "To: Ariel";
    const FROM_NAME = "From: Aster";
    const MESSAGE   = "Merry Christmas üéÑ\nIt has been one of my quiet joys to meet you at the end of 2025.\nYou brought light into my simple, unadorned life, and because of you, the world feels brighter.\nBeing with you makes me feel seventeen again‚Äîstanding at the edge of youth, full of warmth and possibility.\nThough I am still learning and growing, I am willing to walk with you in this moment, and to share whatever time we are given.\nEven if one day I become only a passerby on your path, I will always feel grateful that you were part of my journey, and one of the experiences that helped me grow.";
    const AUDIO_FILE = "mistletoe.mp3";
    
    // ===== Text style (edit here like Jupyter variables) =====
    const CARD_TEXT_ALIGN = "left";     // "left" only (what you want)
    const CARD_FONT_SIZE  = 20;         // message font size
    const CARD_TEXT_COLOR = "#FFEFEF";  // message color (hex)
    const TO_FROM_COLOR   = "#FFFFFF";  // To/From color
    const TO_FONT_SIZE   = 18;
    const FROM_FONT_SIZE = 16;

    // ===========================
    let opened = false;
    let openBtn;

    let snow = [];
    let sparkles = [];
    let typed = "";
    let typeIdx = 0;

    let song;
    let playBtn, volSlider;

    function preload() {
      soundFormats('mp3', 'wav', 'ogg');
      song = loadSound(AUDIO_FILE);
    }
    function setup() {
      createCanvas(windowWidth, windowHeight);
    
      textFont("system-ui, -apple-system, Segoe UI, Roboto, Arial");
      textAlign(CENTER, CENTER);
    
      // Snow
      for (let i = 0; i < 220; i++) snow.push(makeSnowflake());
    
      // UI: Play / Pause + Volume
      playBtn = createButton("‚ñ∂ Play music");
      playBtn.position(16, 16);
      styleButton(playBtn);
      playBtn.mousePressed(toggleMusic);
    
      volSlider = createSlider(0, 100, 55, 1);
      volSlider.position(16, 56);
      volSlider.style("width", "160px");
    
      // Hide music controls until card is opened
      playBtn.hide();
      volSlider.hide();
    
      // Open card button (create AFTER canvas so width/height are correct)
      openBtn = createButton("Open the card üéÅ");
      openBtn.size(180, 44);
      openBtn.style("border", "0");
      openBtn.style("border-radius", "14px");
      openBtn.style("cursor", "pointer");
      openBtn.style("font-size", "16px");
      openBtn.style("background", "rgba(255,255,255,0.16)");
      openBtn.style("color", "white");
      openBtn.style("backdrop-filter", "blur(8px)");
    
      // center it
      openBtn.position(windowWidth / 2 - 90, windowHeight / 2 - 22);
    
      openBtn.mousePressed(() => {
        opened = true;
        openBtn.hide();
    
        // show music controls after opening
        playBtn.show();
        volSlider.show();
    
        // start audio context
        userStartAudio();
      });
    }

    function draw() {
      drawGradient();

    if (!opened) {
      if (snow.length > 0) drawSnow();  // Èò≤Ê≠¢Èõ™Ëä±Êú™ÂàùÂßãÂåñÈÄ†ÊàêÈåØË™§
      drawCoverText();
      return;
    }
  
    // After opened:
    drawLights();
    drawSnow();
    drawTree();
    drawCardText();
    drawSparkles();
  
    if (song && song.isLoaded()) {
      song.setVolume(volSlider.value() / 100);
    }
   }

    function drawCoverText() {
    noStroke();
    fill(255, 255, 255, 210);
    textAlign(CENTER, CENTER);
    textSize(28);
    text("A Christmas message for you ‚ú®", width / 2, height / 2 - 80);
  
    fill(255, 255, 255, 140);
    textSize(14);
    text("Click the button to open", width / 2, height / 2 - 46);
  }

    function drawGradient() {
      noFill();
      for (let y = 0; y < height; y++) {
        const t = y / height;
        const r = lerp(5, 18, t);
        const g = lerp(8, 20, t);
        const b = lerp(20, 55, t);
        stroke(r, g, b);
        line(0, y, width, y);
      }
    }

    function drawLights() {
      const n = 24;
      stroke(255, 255, 255, 70);
      strokeWeight(2);
      noFill();

      beginShape();
      for (let i = 0; i < n; i++) {
        const x = map(i, 0, n - 1, width * 0.08, width * 0.92);
        const sag = sin((i / (n - 1)) * PI) * 26;
        vertex(x, 72 + sag);
      }
      endShape();

      noStroke();
      for (let i = 0; i < n; i++) {
        const x = map(i, 0, n - 1, width * 0.08, width * 0.92);
        const sag = sin((i / (n - 1)) * PI) * 26;
        const y = 72 + sag;

        const pulse = 0.55 + 0.45 * sin(frameCount * 0.05 + i);
        const mode = i % 4;
        let cr = 255 * (mode === 0 || mode === 3 ? 1 : 0.45);
        let cg = 255 * (mode === 1 || mode === 3 ? 1 : 0.45);
        let cb = 255 * (mode === 2 ? 1 : 0.45);

        fill(cr, cg, cb, 140 + 100 * pulse);
        ellipse(x, y, 10 + 6 * pulse);

        fill(255, 255, 255, 28 + 28 * pulse);
        ellipse(x, y, 28);
      }
    }

    function makeSnowflake() {
      return {
        x: random(width),
        y: random(-height, height),
        r: random(1.2, 3.4),
        spd: random(0.6, 2.0),
        drift: random(-0.7, 0.7),
      };
    }

    function drawSnow() {
      noStroke();
      for (let s of snow) {
        fill(255, 255, 255, 190);
        circle(s.x, s.y, s.r * 2);
        s.y += s.spd;
        s.x += s.drift + sin(frameCount * 0.01 + s.y * 0.02) * 0.2;

        if (s.y > height + 10) {
          s.y = random(-120, -10);
          s.x = random(width);
        }
        if (s.x < -20) s.x = width + 20;
        if (s.x > width + 20) s.x = -20;
      }
    }

    function drawTree() {
      noStroke();
      fill(255, 255, 255, 18);
      ellipse(width * 0.5, height * 0.86, width * 0.7, height * 0.22);

      push();
      translate(width * 0.5, height * 0.70);
      const baseW = min(width, height) * 0.48;

      fill(0, 0, 0, 140);
      triangle(0, -baseW * 0.55, -baseW * 0.12, -baseW * 0.20, baseW * 0.12, -baseW * 0.20);
      triangle(0, -baseW * 0.28, -baseW * 0.20, 0, baseW * 0.20, 0);
      triangle(0, 0, -baseW * 0.28, baseW * 0.32, baseW * 0.28, baseW * 0.32);

      rectMode(CENTER);
      rect(0, baseW * 0.40, baseW * 0.08, baseW * 0.16, 8);

      const starPulse = 0.6 + 0.4 * sin(frameCount * 0.06);
      translate(0, -baseW * 0.62);
      drawStar(0, 0, 10, 22 + 6 * starPulse, 5, starPulse);
      pop();
    }

    function drawStar(x, y, r1, r2, n, pulse) {
      push();
      translate(x, y);
      noStroke();
      fill(255, 255, 200, 140 + 80 * pulse);
      beginShape();
      for (let i = 0; i < n * 2; i++) {
        const ang = (PI / n) * i;
        const rr = (i % 2 === 0) ? r2 : r1;
        vertex(cos(ang) * rr, sin(ang) * rr);
      }
      endShape(CLOSE);

      fill(255, 255, 220, 25 + 25 * pulse);
      ellipse(0, 0, r2 * 3.0);
      pop();
    }

    function drawCardText() {
      const panelW = min(860, width * 0.90);
      const panelH = 300;
      const BORDER_INSET = 30; // Êï∏Â≠óË∂äÂ§ßÔºåborder Ë∂äÂ∞è„ÄÅÈõ¢ÂÖßÂÆπË∂äÈÅ†
      const px = width / 3;
      const py = height / 2;   // ‚úÖ Âç°ÁâáÂú®Áï´Èù¢Ê≠£‰∏≠Â§Æ
      const TEXT_SHIFT_X = 15 * 37.8; // 15 cm ‚âà 567 px (‰ª• 96dpi ‰º∞ÁÆó)

      // Card border
      noStroke();
      fill(255, 255, 255, 0.10);
      rectMode(CENTER);
      rect(
        px,
        py,
        panelW - BORDER_INSET * 2,
        panelH - BORDER_INSET * 2,
        22
      );

    
      // Inner padding
      const pad = 32;
      const leftX = px - panelW / 2 + pad + TEXT_SHIFT_X;
      const rightX = px + panelW / 2 - pad;
      const topY  = py - panelH / 2 + panelH * 0.18; // ‚úÖ ÊñáÂ≠óË¶ñË¶∫ÁΩÆ‰∏≠
      const SAFE_BOTTOM = 18; // Èò≤Ê≠¢ From Ë¢´ border ÂêÉÊéâ
    
      // To
      fill(TO_FROM_COLOR);
      textAlign(LEFT, TOP);
      textSize(TO_FONT_SIZE);
      text(TO_NAME, leftX, topY);
    
      // Message
      fill(CARD_TEXT_COLOR);
      textSize(CARD_FONT_SIZE);
      textWrap(WORD);
      text(MESSAGE, leftX, topY + 44, panelW - pad * 2);
    
      // From (right, safe)
      fill(TO_FROM_COLOR);
      textAlign(RIGHT, BOTTOM);
      textSize(FROM_FONT_SIZE);
      text(
        FROM_NAME,
        rightX,
        py + panelH / 2 - pad - SAFE_BOTTOM
      );
    }

    function mousePressed() {
      if (!opened) return;  // Â∞ÅÈù¢ÈöéÊÆµ‰∏çÁîüÊàêÁ≤íÂ≠êÔºåÈÅøÂÖçÂ£ìÂäõ/Áï∞Â∏∏
    
      for (let i = 0; i < 90; i++) {
        sparkles.push({
          x: mouseX,
          y: mouseY,
          vx: random(-3, 3),
          vy: random(-3, 3),
          life: 255
        });
      }
    }

    function drawSparkles() {
      for (let p of sparkles) {
        noStroke();
        fill(255, 255, 255, p.life);
        circle(p.x, p.y, 3);
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.03;
        p.life -= 5;
      }
      sparkles = sparkles.filter(p => p.life > 0);
    }

    function styleButton(btn) {
      btn.style("padding", "10px 12px");
      btn.style("border", "0");
      btn.style("border-radius", "12px");
      btn.style("cursor", "pointer");
      btn.style("font-size", "14px");
      btn.style("background", "rgba(255,255,255,0.14)");
      btn.style("color", "white");
      btn.style("backdrop-filter", "blur(6px)");
    }

    function toggleMusic() {
      // Browser requires a user gesture to start audio
      userStartAudio();

      if (!song || !song.isLoaded()) {
        playBtn.html("‚ö† Music not loaded");
        return;
      }

      if (song.isPlaying()) {
        song.pause();
        playBtn.html("‚ñ∂ Play music");
      } else {
        song.loop();
        playBtn.html("‚è∏ Pause music");
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    
      if (openBtn && !opened) {
        openBtn.position(windowWidth / 2 - 90, windowHeight / 2 - 22);
      }
    }

  </script>
</body>
</html>
